<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Covey.Liu">
  
  
  
  
  
  <link rel="canonical" href="https://fanny.github.io/blog/2019/dockerizando-minha-aplicacao-apollo/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Dockerizando Minha Aplicação Apollo | Fanny&#39;s Blog
       
  </title>
  <meta name="title" content="Dockerizando Minha Aplicação Apollo | Fanny&#39;s Blog">
    
  
  <link rel="stylesheet" href="/blog/font/iconfont.css">
  <link rel="stylesheet" href="/blog/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://fanny.github.io/blog"
    },
    "articleSection" : "posts",
    "name" : "Dockerizando Minha Aplicação Apollo",
    "headline" : "Dockerizando Minha Aplicação Apollo",
    "description" : "Além de computação, eu amo música, e em todo post meu, vou te recomendar um álbum/música de artista que estou conhecendo ou que já ouvi e gostei muito, tá bem?
Enquanto eu escrevo, esse post, estou ouvindo uma música do Iron &amp; Wine, a &ldquo;Such Great Heights&rdquo;, eles tem um estilo de folk rock, muito amorzinho. A primeira vez que escutei ele, foi em uma cena de crepúsculo, quando eu ouvi eu senti uma paz, uma sensação boa de aconchego, como se eu quisesse abraçar eu mesma, e tudo estivesse bem, sabe?",
    "inLanguage" : "en-us",
    "author" : "Fanny Vieira",
    "creator" : "Fanny Vieira",
    "publisher": "Fanny Vieira",
    "accountablePerson" : "Fanny Vieira",
    "copyrightHolder" : "Fanny Vieira",
    "copyrightYear" : "2019",
    "datePublished": "2019-04-28 22:30:24 -0300 -03",
    "dateModified" : "2019-04-28 22:30:24 -0300 -03",
    "url" : "https://fanny.github.io/blog/2019/dockerizando-minha-aplicacao-apollo/",
    "wordCount" : "1794",
    "keywords" : [ "Docker","Apollo","Apollo-Server","Development", "Fanny&#39;s Blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://fanny.github.io/blog">Fanny&#39;s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/blog/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/blog/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/blog/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/blog/about/" title="">About</a>
                
                <a class="menu-item" href="/blog/about/" title="About Hugo">About Hugo</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://fanny.github.io/blog">Fanny&#39;s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/blog/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/blog/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/blog/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/blog/about/" title="">About</a>
                
                <a class="menu-item" href="/blog/about/" title="About Hugo">About Hugo</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Dockerizando Minha Aplicação Apollo</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://fanny.github.io/blog" rel="author">Fanny Vieira</a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-04-28 itemprop="datePublished">April 28, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://fanny.github.io/blog/categories/uncategorized/"> Uncategorized </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<p>Além de computação, eu amo música, e em todo post meu, vou te recomendar um álbum/música de artista que estou conhecendo ou que já ouvi e gostei muito, tá bem?</p>

<p>Enquanto eu escrevo, esse post, estou ouvindo uma música do <a href="https://pt.wikipedia.org/wiki/Iron_%26_Wine" rel="nofollow noreferrer" target="_blank">Iron &amp; Wine</a>, a &ldquo;Such Great Heights&rdquo;, eles tem um estilo de folk rock, muito amorzinho. A primeira vez que escutei ele, foi em uma <a href="https://www.youtube.com/watch?v=H732zJgRDt4" rel="nofollow noreferrer" target="_blank">cena de crepúsculo</a>, quando eu ouvi eu senti uma paz, uma sensação boa de aconchego, como se eu quisesse abraçar eu mesma, e tudo estivesse bem, sabe? Eles são muito bons pra ouvir quando você quer ter um momento de conexão consigo mesmo, então fica aí a sugestão.</p>

<iframe src="https://open.spotify.com/embed/track/6kLqKntp2x4QVXHwqLHMYm" width="300" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

<p>Durante meu processo de aprendizagem do docker, eu encontrei um <a href="https://dev.to/azure/docker---from-the-beginning-part-i-28c6" rel="nofollow noreferrer" target="_blank">tutorial fantástico</a> que me ajudou a entender muitos dos conceitos que eu tinha dificuldade. Então, eu decidi traduzi-lo pra que outras pessoas também pudessem ter essa mesma experiência, além disso, alguns amigos que fazem projeto comigo, não entendiam a configuração de docker que eu fiz, como uma forma de ajudá-los, decidi criar um tutorial inspirado nesse primeiro, que conseguisse cobrir todos os tópicos e funcionalidades usadas.</p>

<p>Muito obrigada, <a href="https://dev.to/softchris" rel="nofollow noreferrer" target="_blank">@softchris</a>, você fez um trabalho íncrivel! &lt;3<br />
<em>Thank you, so much, <a href="https://dev.to/softchris" rel="nofollow noreferrer" target="_blank">@softchris</a>, you did an incredible job! &lt;3</em></p>

<p>Então, vamos lá.</p>

<p>Neste artigo, iremos cobrir os seguintes tópicos:</p>

<p><strong>O que é Docker e por quê usá-lo?</strong> Esse tópico é provavelmente um dos mais importantes do artigo, por quê o Docker? Por quê não usar outras tecnologias? Tentarei explicar o quê é docker e em que ele consiste.</p>

<p><strong>Criando nossa aplicação</strong>. Vamos criar um simples hello-world no apollo-server.</p>

<p><strong>Dockerizando nossa aplicação</strong>. Vamos dockerizar uma aplicação para mostrar o que entendemos e podemos usar com os principais conceitos do docker.</p>

<p><strong>Gerenciando o container</strong>. Agora é muito fácil subir um container, mas também precisamos aprender a gerenciá-lo, já que não queremos que ele fique executando pra sempre.</p>

<p>Essa é a primeira parte da série, nos próximos posts pretendemos abordar, volumes, linkamento, microsserviços, e orquestração.</p>

<h2 id="por-quê-usar-o-docker">Por quê usar o docker?</h2>

<p>O docker te ajuda a criar um ambiente reproduzível. Você consegue especificar um Sistema Operacional(S.O) específico, a versão exata de diferentes bibliotecas, diferentes variáveis de ambiente e seus valores, dentre outras coisas. E o que é mais importante, você consegue executar sua aplicação isoladamente dentro desse ambiente.</p>

<h2 id="e-por-quê-você-iria-querer-isso">E por quê você iria querer isso?</h2>

<p><strong>Integração do time com novos desenvolvedores</strong>.  A maioria dos times pode passar pelo processo de integrar um desenvolvedor a um projeto que já existe, e pode ser um processo traumático  para ele ter que instalar SDK’s, ferramentas de desenvolvimento, banco de dados,adicionar permissões, muitas vezes chegando a levar semanas.<br />
<strong>Ambientes com a mesma configuração</strong>. É muito comum querer reproduzir o ambiente de produção no de desenvolvimento, muitas vezes, quando a configuração não é a mesma, pode ser difícil mapear o motivo dos erros, porque o problema pode ter sido pelo ambiente de execução. Usando o Docker, você pode criar um ambiente DEV, STAGING e PRODUÇÃO, todos com as mesmas definições.<br />
<strong>O famoso jargão &ldquo;Funciona na minha máquina&rdquo;</strong>. O docker criar contêineres isolados, onde você especifica exatamente o que eles devem conter, você pode enviar esses containers aos clientes e eles irão funcionar da mesma forma que na sua máquina de desenvolvimento.</p>

<h2 id="o-que-é-o-docker">O que é o docker?</h2>

<p>Certo, já temos mencionado boas razões para usar o docker, mas precisamos ir um pouco mais a fundo sobre o que o docker é. Nós definimos que ele nos permite especificar um ambiente como um SO, como encontrar e executar apps e as variáveis necessárias, mas o que o docker tem além disso que podemos saber?</p>

<p>Docker por si só, cria pacotes chamados containers, que contém tudo o que você precisa pra rodar sua aplicação. Cada container tem sua própria memória, CPU e rede e não depende de um sistema operacional ou kernel. A primeira coisa que vem em mente quando citamos containers, são as maquinas virtuais, mas o docker difere-se na maneira com a qual ele compartilha os recursos. Docker usa o chamado “sistema de arquivos em camadas” que permite que os containers compartilhem partes comuns e o resultado final é que os containers são muito menos dependendentes de recursos no sistema host do que uma máquina virtual.</p>

<p>Resumindo, os containers do docker, contém tudo que você precisa pra executar uma aplicação, incluindo o código fonte que você escreveu. Containers também são unidades leves e seguras no seu sistema, Isso torna fácil a criação de vários microserviços que são escritos em diferentes linguagens de programação e que estão usando diferentes versões da mesma biblioteca e do mesmo SO.</p>

<p>Se você está curioso sobre como exatamente funciona o Docker, eu recomendo fortemente que você dê uma olhada nos seguintes links: <a href="http://aufs.sourceforge.net/" rel="nofollow noreferrer" target="_blank">layered file system</a> e a blibioteca <a href="https://github.com/opencontainers/runc" rel="nofollow noreferrer" target="_blank">runc</a> e também a <a href="https://en.wikipedia.org/wiki/Docker_%28software%29" rel="nofollow noreferrer" target="_blank">wikipedia</a> tem uma boa visão geral do Docker.</p>

<h2 id="docker-em-ação">Docker em ação</h2>

<p>Hummm, certo, nós já vimos o que é o Docker e seus benefícios, nós também entendemos que o que executa nossa aplicação é chamado de container. Mas como nós fazemos isso? Bem, nós começamos definindo um arquivo de descrição, chamado de <em>DockerFile</em>. Neste <em>DockerFile</em>, nós especificamos tudo que precisamos em termos de SO, variáveis de ambiente, e como conseguimos colocar nossa aplicação lá.</p>

<p>Para fazer isso, seguimos os seguintes passos:</p>

<p><strong>Criação da aplicação</strong>, nós iremos criar um api servida pelo apollo.<br />
<strong>Criação de um dockerfile</strong>, um arquivo de texto que descreve como o docker deve construir nossa aplicação.<br />
<strong>Construção de uma imagem</strong>, antes de levantar e executar nossa aplicação, é necessário ter uma imagem, você entenderá o motivo.<br />
<strong>Criação de um container</strong>, esse é o passo final onde nós vemos nossa aplicação levantada e executando, nós criaremos um container, a partir da imagem criada no passo anterior.</p>

<h2 id="criando-a-aplicação-do-apollo-server">Criando a aplicação do apollo-server</h2>

<p>Para agilizar o tutorial, vou mostrar apenas a configuração que segui, que foi do <a href="https://www.apollographql.com/docs/apollo-server/" rel="nofollow noreferrer" target="_blank">getting-started do Apollo-Server</a></p>

<h2 id="criando-um-dockerfile">Criando um dockerfile</h2>

<p>Certo, o próximo passo é definir nosso dockerfile. Esse arquivo atua como um manifest, mas também como um arquivo de instrução de como fazer o build, em que nós podemos levantar nossa aplicação e executar. Ok, então o que nós precisamos para ter isso?</p>

<ol>
<li><strong>copiar</strong> todos os arquivos do nosso app para o container do docker<br /></li>
<li><strong>instalar</strong> as dependências<br /></li>
<li><strong>expor uma porta</strong>, que possa ser acessada de fora do container<br /></li>
<li><strong>instruir</strong>, o container sobre como iniciar nossa aplicação<br /></li>
</ol>

<p>Em aplicações mais complexas, nós podemos precisar fazer outras coisas, como setar variáveis de ambiente, ou credenciais para um banco de dados, usar <code>seeds</code> para popular nosso banco de dados. Mas para agora, nós só precisamos das coisas que descrevemos acima, Então vamos expressar isso no nosso Dockerfile:</p>

<pre><code class="language-Dockerfile">FROM node:latest

WORKDIR /server

COPY . .

ENV PORT 5000

RUN npm install

EXPOSE $PORT

ENTRYPOINT [&quot;npm&quot;, &quot;start&quot;]
</code></pre>

<p><strong>FROM</strong> Este comando seleciona a imagem do sistema operacional, a partir do Docker Hub. <a href="https://hub.docker.com/" rel="nofollow noreferrer" target="_blank">Docker Hub</a> um repositório global que contém imagens que podemos baixar localmente. No nosso caso, podemos escolher uma imagem baseada no Ubuntu que tem o node instalado, e nós podemos especificar que queremos a última versão, usando a tag <code>:latest</code><br />
<strong>WORKDIR</strong> Isso simplesmente significa que nós estamos configurando um diretório de trabalho. Isso é uma maneira de definir onde nossos arquivos ficarão no container.<br />
<strong>COPY</strong> Aqui nós copiamos os arquivos do diretório atual, para o diretório que acabamos de criar com o <code>WORKDIR</code>.<br />
<strong>RUN</strong> Isso executa um comando no terminal, no nosso caso, queremos instalar as bibliotecas necessárias para construir nosso apollo-server, por isso, usamos o <code>npm install</code>.<br />
<strong>EXPOSE</strong> Isso significa que estamos expondo uma porta, e é através dessa porta que vamos nos comunicar com o nosso container.<br />
<strong>ENTRYPOINT</strong> Isso representa o comando que precisamos executar para inicializar nossa aplicação, os comandos precisam ser especificados como um array, no nosso caso, isso será traduzido como <code>npm start</code></p>

<h2 id="construindo-uma-imagem">Construindo uma imagem</h2>

<p>Há dois passos que precisamos implementar para levantar e executar nosso container, eles são:</p>

<p><strong>Criação de uma imagem</strong>, com a ajuda do <code>Dockerfile</code> e do comando <code>docker build</code> nós criaremos uma imagem.<br />
<strong>Execução do container</strong>, Agora que temos uma imagem, precisamos criar um container.</p>

<p>Antes de tudo, você deve estar se perguntando, certo, mas o que é uma imagem, porque eu preciso dela?</p>

<p>Como minha amiga, <a href="https://github.com/thayannevls" rel="nofollow noreferrer" target="_blank">@thayannevls</a> diz:</p>

<blockquote>
<p>&ldquo;Pense na imagem como uma classe, e o container como um objeto em Orientação a Objeto(OO)&rdquo;</p>
</blockquote>

<p>Certo, vamos analisar essa frase, por que a imagem representa uma classe? Quando falamos em classes, pensamos num template no qual definimos atributos e comportamentos da nossa entidade. Uma imagem, é definida pelo <code>Dockerfile</code>, que como vimos, é onde instruímos, como o docker deve fazer o build, muitas vezes só usamos as imagens prontas que estão definidas no repositório do docker, o Dockerhub, e as vezes pegamos imagens prontas e fazemos modificações, como é o nosso caso. E o nosso container, é justamente a nossa imagem em execução, daí a analogia com os objetos.</p>

<p>Primeiro de tudo, vamos criar nossa imagem com o seguinte comando:</p>

<p><code>docker build -f .docker/node.dockerfile .</code></p>

<p>A instrução acima cria uma imagem. O <code>.</code> no final é importante, serve para especficar que o diretório raiz da app, é o que estamos atualmente, a opção <code>-f</code> dockerfile está localizado, nesse caso, no diretório <code>.docker/</code>. Se você não tiver a imagem definida no <code>Dockerfile</code>(usando o comando FROM, linha 1), no nosso caso, a do node, o docker irá primeiro baixá-la a partir do dockerhub, e seu terminal parecerá com isso.</p>

<p><em>OBS: Caso o dockerfile estivesse no diretório atual, executaríamos o seguinte:</em>
<code>docker build .</code></p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://i.imgur.com/KTt1Hro.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<p>O que você está vendo, é como o docker está baixando a imagem do node a partir do dockerhub, e então cada comando está sendo executado, WORKDIR, RUN, e os outros. No final, nós vemos &ldquo;sucessfuly built&rdquo; que é um ínicio de que tudo foi construído com sucesso. Vamos dar uma olhada na nossa imagem com:</p>

<p><code>docker images</code></p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://i.imgur.com/rw2cyVO.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<h2 id="criando-um-container">Criando um container</h2>

<p>O próximo passo é pegar nossa imagem e construir um container a partir dela. Um container é essa peça isolada que executa nossa aplicação dentro dele. Nós construimos um container usando o comando docker run. O comando completo se parece com:</p>

<p><code>docker run ID_IMAGE</code></p>

<p>Mas isso não é o suficiente, precisamos mapear a nossa porta interna à externa, da nossa máquina host. Lembre-se que esse é um app que queremos interagir atraves do nosso browser. Nós podemos mapear usando a flag -p</p>

<p><code>-p [external port]:[internal port]</code></p>

<p>Agora o comando completo, se parece com:</p>

<p><code>docker run -p 8000:5000 ID_IMAGE</code></p>

<p>Ok, executando esse comando significa que nós conseguiremos visitar nosso container através da url <a href="http://localhost:8000" rel="nofollow noreferrer" target="_blank">http://localhost:8000</a>, <code>8000</code> é a nossa porta externa, lembre-se que o comando acima mapea 8000 para a ponta interna 3000. Bora ver, abrindo o browser temos:</p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="https://i.imgur.com/N780k5Q.png" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<p>É isto, temos nossa app no ar, pipous! :D</p>

<h2 id="referências-links-para-estudo">Referências &amp; Links para estudo</h2>

<p><a href="https://docker-curriculum.com/#getting-started" rel="nofollow noreferrer" target="_blank">https://docker-curriculum.com/#getting-started</a></p>

<p><a href="https://docs.docker.com/get-started/" rel="nofollow noreferrer" target="_blank">https://docs.docker.com/get-started/</a></p>

<p><a href="https://dev.to/softchris/5-part-docker-series-beginner-to-master-3m1b" rel="nofollow noreferrer" target="_blank">https://dev.to/softchris/5-part-docker-series-beginner-to-master-3m1b</a></p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Covey.Liu </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://fanny.github.io/blog/2019/dockerizando-minha-aplicacao-apollo/>https://fanny.github.io/blog/2019/dockerizando-minha-aplicacao-apollo/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://fanny.github.io/blog/tags/docker/">
                    #Docker</a></span>
            
            <span class="tag"><a href="https://fanny.github.io/blog/tags/apollo/">
                    #Apollo</a></span>
            
            <span class="tag"><a href="https://fanny.github.io/blog/tags/apollo-server/">
                    #Apollo-Server</a></span>
            
            <span class="tag"><a href="https://fanny.github.io/blog/tags/development/">
                    #Development</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://fanny.github.io/blog">home</a></span>
        </section>
    </div>

    <div class="post-nav">
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2011 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://fanny.github.io/blog">Covey.Liu</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/blog/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
